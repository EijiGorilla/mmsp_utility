"use strict";(self.webpackChunkmmsp_utility=self.webpackChunkmmsp_utility||[]).push([[4650],{94650:(e,r,t)=>{t.r(r),t.d(r,{fromUrl:()=>d});var a=t(10064),n=t(35995),l=t(25899),o=t(84076),s=t(74368),i=t(37933),u=t(19610),c=t(41226);const y={FeatureLayer:!0,SceneLayer:!0};async function d(e){var r;const u=null===(r=e.properties)||void 0===r?void 0:r.customParameters,d=await async function(e,r){let t=(0,l.Qc)(e);if(null==t&&(t=await async function(e,r){var t,a;const o=await(0,c.T)(e,{customParameters:r});let s=null,i=null;const u=o.type;if("Feature Layer"===u||"Table"===u?(s="FeatureServer",i=null!==(t=o.id)&&void 0!==t?t:null):"indexedVector"===u?s="VectorTileServer":o.hasOwnProperty("mapName")?s="MapServer":o.hasOwnProperty("bandCount")&&o.hasOwnProperty("pixelSizeX")?s="ImageServer":o.hasOwnProperty("maxRecordCount")&&o.hasOwnProperty("allowGeometryUpdates")?s="FeatureServer":o.hasOwnProperty("streamUrls")?s="StreamServer":f(o)?(s="SceneServer",i=o.id):o.hasOwnProperty("layers")&&f(null===(a=o.layers)||void 0===a?void 0:a[0])&&(s="SceneServer"),!s)return null;const y=null!=i?(0,l.DR)(e):null;return{title:null!=y&&o.name||(0,n.vt)(e),serverType:s,sublayer:i,url:{path:null!=y?y.serviceUrl:(0,n.mN)(e).path}}}(e,r)),null==t)throw new a.Z("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:u,sublayer:d}=t;let v;const m={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"},w="FeatureServer"===u,h="SceneServer"===u,S={parsedUrl:t,Constructor:null,layerId:(w||h)&&null!==d&&void 0!==d?d:void 0,layers:[],tables:[]};switch(u){case"MapServer":v=null!=d?"FeatureLayer":await async function(e,r){return(await(0,c.T)(e,{customParameters:r})).tileInfo}(e,r)?"TileLayer":"MapImageLayer";break;case"ImageServer":{var I;const t=await(0,c.T)(e,{customParameters:r}),{tileInfo:a,cacheType:n}=t;v=a?"LERC"!==(null===a||void 0===a||null===(I=a.format)||void 0===I?void 0:I.toUpperCase())||n&&"elevation"!==n.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer";break}case"SceneServer":{const e=await(0,c.T)(t.url.path,{customParameters:r});if(v="SceneLayer",e){const r=null===e||void 0===e?void 0:e.layers;if("Voxel"===(null===e||void 0===e?void 0:e.layerType))v="VoxelLayer";else if(null!==r&&void 0!==r&&r.length){var b;const e=null===(b=r[0])||void 0===b?void 0:b.layerType;null!=e&&null!=i.fb[e]&&(v=i.fb[e])}}break}case"FeatureServer":if(v="FeatureLayer",null!=d){const t=await(0,c.T)(e,{customParameters:r});S.sourceJSON=t,"Oriented Imagery Layer"===t.type&&(v="OrientedImageryLayer")}break;default:v=m[u]}if(y[v]&&null==d){var g;const t=await async function(e,r,t){var a,n;let l,i,u=!1;switch(r){case"FeatureServer":{const r=await(0,s.V)(e,{customParameters:t});u=!!r.layersJSON,l=r.layersJSON||r.serviceJSON;break}case"SceneServer":{const r=await async function(e,r){var t;const a=await(0,c.T)(e,{customParameters:r}),n=null===(t=a.layers)||void 0===t?void 0:t[0];if(!n)return{serviceInfo:a};try{const{serverUrl:t}=await(0,o.w)(e),n=await(0,c.T)(t,{customParameters:r}).catch((()=>null));return n&&(a.tables=n.tables),{serviceInfo:a,tableServerUrl:t}}catch{return{serviceInfo:a}}}(e,t);l=r.serviceInfo,i=r.tableServerUrl;break}default:l=await(0,c.T)(e,{customParameters:t})}const y=null===(a=l)||void 0===a?void 0:a.layers,d=null===(n=l)||void 0===n?void 0:n.tables;return{layers:(null===y||void 0===y?void 0:y.map((e=>({id:e.id}))).reverse())||[],tables:(null===d||void 0===d?void 0:d.map((e=>({serverUrl:i,id:e.id}))).reverse())||[],layerInfos:u?y:[],tableInfos:u?d:[]}}(e,u,r);if(w&&(S.sublayerInfos=t.layerInfos,S.tableInfos=t.tableInfos),1!==t.layers.length+t.tables.length)S.layers=t.layers,S.tables=t.tables,w&&(null===(g=t.layerInfos)||void 0===g?void 0:g.length)&&(S.sublayerConstructorProvider=await async function(e){const r=[],t=[];if(e.forEach((e=>{const{type:a}=e;"Oriented Imagery Layer"===a?(r.push(a),t.push(p("OrientedImageryLayer"))):(r.push(a),t.push(p("FeatureLayer")))})),!t.length)return;const a=await Promise.all(t),n=new Map;return r.forEach(((e,r)=>{n.set(e,a[r])})),e=>n.get(e.type)}(t.layerInfos));else if(w||h){var L,T,O,P,U,F;const e=null!==(L=null===(T=t.layerInfos)||void 0===T?void 0:T[0])&&void 0!==L?L:null===(O=t.tableInfos)||void 0===O?void 0:O[0];S.layerId=null!==(P=null===(U=t.layers[0])||void 0===U?void 0:U.id)&&void 0!==P?P:null===(F=t.tables[0])||void 0===F?void 0:F.id,S.sourceJSON=e,w&&"Oriented Imagery Layer"===(null===e||void 0===e?void 0:e.type)&&(v="OrientedImageryLayer")}}return S.Constructor=await p(v),S}(e.url,u),m={...e.properties,url:e.url};if(d.layers.length+d.tables.length===0)return null!=d.layerId&&(m.layerId=d.layerId),null!=d.sourceJSON&&(m.sourceJSON=d.sourceJSON),new d.Constructor(m);const w=new(0,(await Promise.resolve().then(t.bind(t,18048))).default)({title:d.parsedUrl.title});return await async function(e,r,t){function a(e,r,a,n){const l={...t,layerId:r,sublayerTitleMode:"service-name"};return null!=e&&(l.url=e),null!=a&&(l.sourceJSON=a),n(l)}const n=r.sublayerConstructorProvider;for(const{id:o,serverUrl:s}of r.layers){var l;const t=v(r.sublayerInfos,o),i=null!==(l=t&&(null===n||void 0===n?void 0:n(t)))&&void 0!==l?l:r.Constructor,u=a(s,o,t,(e=>new i(e)));e.add(u)}if(r.tables.length){const t=await p("FeatureLayer");r.tables.forEach((n=>{let{id:l,serverUrl:o}=n;const s=a(o,l,v(r.tableInfos,l),(e=>new t(e)));e.tables.add(s)}))}}(w,d,m),w}function v(e,r){return e?e.find((e=>e.id===r)):null}function f(e){return null!=e&&e.hasOwnProperty("store")&&e.hasOwnProperty("id")&&"number"==typeof e.id}async function p(e){return(0,u.T[e])()}},84076:(e,r,t)=>{t.d(r,{w:()=>c});var a=t(19545),n=t(76200),l=t(10064),o=t(66978),s=t(25899),i=t(7575),u=t(98995);async function c(e,r){var t,c;const v=(0,s.Qc)(e);if(!v)throw new l.Z("invalid-url","Invalid scene service url");const f={...r,sceneServerUrl:v.url.path,layerId:null!==(t=v.sublayer)&&void 0!==t?t:void 0};if(null!==(c=f.sceneLayerItem)&&void 0!==c||(f.sceneLayerItem=await async function(e){const r=(await y(e)).serviceItemId;if(!r)return null;const t=new u.default({id:r,apiKey:e.apiKey}),l=await async function(e){const r=null===a.id||void 0===a.id?void 0:a.id.findServerInfo(e.sceneServerUrl);if(null!==r&&void 0!==r&&r.owningSystemUrl)return r.owningSystemUrl;const t=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await(0,n.Z)(t,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(r)return r}catch(p){(0,o.r9)(p)}return null}(e);null!=l&&(t.portal=new i.Z({url:l}));try{return t.load({signal:e.signal})}catch(m){return(0,o.r9)(m),null}}(f)),null==f.sceneLayerItem)return d(f.sceneServerUrl.replace("/SceneServer","/FeatureServer"),f);const p=await async function(e){let{sceneLayerItem:r,signal:t}=e;if(!r)return null;try{const e=(await r.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:t})).find((e=>"Feature Service"===e.type))||null;if(!e)return null;const a=new u.default({portal:e.portal,id:e.id});return await a.load(),a}catch(a){return(0,o.r9)(a),null}}(f);if(null===p||void 0===p||!p.url)throw new l.Z("related-service-not-found","Could not find feature service through portal item relationship");const m=await d(p.url,f);return m.portalItem=p,m}async function y(e){if(e.rootDocument)return e.rootDocument;const r={query:{f:"json",token:e.apiKey},responseType:"json",signal:e.signal};try{const t=await(0,n.Z)(e.sceneServerUrl,r);e.rootDocument=t.data}catch{e.rootDocument={}}return e.rootDocument}async function d(e,r){const t=(0,s.Qc)(e);if(!t)throw new l.Z("invalid-feature-service-url","Invalid feature service url");const a=t.url.path,o=r.layerId;if(null==o)return{serverUrl:a};const i=y(r),u=e=>{const t={query:{f:"json"},responseType:"json",authMode:e,signal:r.signal};return(0,n.Z)(a,t)},c=u("anonymous").catch((()=>u("no-prompt"))),[d,v]=await Promise.all([c,i]),f=null===v||void 0===v?void 0:v.layers,p=d.data&&d.data.layers;if(!Array.isArray(p))throw new Error("expected layers array");if(Array.isArray(f)){for(let n=0;n<Math.min(f.length,p.length);n++)if(f[n].id===o)return{serverUrl:a,layerId:p[n].id}}else if(null!=o&&o<p.length)return{serverUrl:a,layerId:p[o].id};throw new Error("could not find matching associated sublayer")}},74368:(e,r,t)=>{t.d(r,{V:()=>n});var a=t(41226);async function n(e,r){var t;const n=await(0,a.T)(e,r);c(n),s(n);const l={serviceJSON:n};if((null!==(t=n.currentVersion)&&void 0!==t?t:0)<10.5)return l;const o=await(0,a.T)(e+"/layers",r);return c(o),s(o),l.layersJSON={layers:o.layers,tables:o.tables},l}function l(e){return"Feature Layer"===e.type||"Oriented Imagery Layer"===e.type}function o(e){return"Table"===e.type}function s(e){var r,t;e.layers=null===(r=e.layers)||void 0===r?void 0:r.filter(l),e.tables=null===(t=e.tables)||void 0===t?void 0:t.filter(o)}function i(e){e.type||(e.type="Feature Layer")}function u(e){e.type||(e.type="Table")}function c(e){var r,t;null!==(r=e.layers)&&void 0!==r&&r.forEach(i),null===(t=e.tables)||void 0===t||t.forEach(u)}},41226:(e,r,t)=>{t.d(r,{T:()=>n});var a=t(76200);async function n(e,r){const{data:t}=await(0,a.Z)(e,{responseType:"json",query:{f:"json",...null===r||void 0===r?void 0:r.customParameters,token:null===r||void 0===r?void 0:r.apiKey}});return t}}}]);
//# sourceMappingURL=4650.a7642610.chunk.js.map